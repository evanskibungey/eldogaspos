# EldoGas POS Offline Mode Documentation\n\n## Overview\n\nThe EldoGas POS system now supports conditional offline functionality. This allows you to:\n\n- **Development Mode**: Work online-only during development (no offline complexity)\n- **Production Mode**: Full offline capabilities for real-world use\n\n## Quick Setup\n\n### For Local Development (Current Setup)\n```bash\n# Keep offline mode disabled (already set)\nphp artisan pos:offline-mode disable\nphp artisan config:clear\n```\n\n### For Production Deployment\n```bash\n# Enable offline mode for production\nphp artisan pos:offline-mode enable\nphp artisan config:clear\n```\n\n## How It Works\n\n### Development Mode (Offline Disabled)\n- ✅ Works with `127.0.0.1:8000` or `localhost/eldogaspos/public`\n- ✅ No \"You're Offline\" messages\n- ✅ All POS features work normally\n- ✅ Sales processing works online\n- ❌ No offline capabilities\n- ❌ No offline storage or sync\n\n### Production Mode (Offline Enabled)\n- ✅ Full offline functionality\n- ✅ Works without internet connection\n- ✅ Automatic background sync when online\n- ✅ Offline sales storage\n- ✅ Connection status monitoring\n- ✅ Manual sync controls\n\n## Configuration\n\n### Environment Variables\n\nIn your `.env` file:\n\n```env\n# For Development\nOFFLINE_MODE_ENABLED=false\n\n# For Production  \nOFFLINE_MODE_ENABLED=true\n```\n\n### Advanced Configuration\n\nEdit `config/offline.php` to customize:\n\n```php\nreturn [\n    'enabled' => env('OFFLINE_MODE_ENABLED', false),\n    \n    'database' => [\n        'name' => 'eldogas_offline_db',\n        'version' => 1,\n    ],\n    \n    'sync' => [\n        'auto_sync_interval' => 30000, // 30 seconds\n        'max_retry_attempts' => 3,\n        'retry_delay' => 5000, // 5 seconds\n    ],\n    \n    'connection_timeout' => 10000, // 10 seconds\n];\n```\n\n## Commands\n\n### Check Current Status\n```bash\nphp artisan pos:offline-mode status\n```\n\n### Enable Offline Mode (Production)\n```bash\nphp artisan pos:offline-mode enable\nphp artisan config:clear\n```\n\n### Disable Offline Mode (Development)\n```bash\nphp artisan pos:offline-mode disable\nphp artisan config:clear\n```\n\n### Fix Products (If Needed)\n```bash\nphp quick_product_fix.php\n```\n\n## Features by Mode\n\n| Feature | Development Mode | Production Mode |\n|---------|-----------------|----------------|\n| Online Sales | ✅ | ✅ |\n| Offline Sales | ❌ | ✅ |\n| Connection Monitoring | Basic | Full |\n| Offline Storage | ❌ | ✅ |\n| Background Sync | ❌ | ✅ |\n| Manual Sync | ❌ | ✅ |\n| Sync Status Panel | ❌ | ✅ |\n| Offline Indicators | Hidden | Shown |\n\n## Production Deployment Steps\n\n1. **Enable Offline Mode**\n   ```bash\n   php artisan pos:offline-mode enable\n   ```\n\n2. **Clear Cache**\n   ```bash\n   php artisan config:clear\n   php artisan cache:clear\n   php artisan view:clear\n   ```\n\n3. **Ensure Products Exist**\n   ```bash\n   php quick_product_fix.php\n   ```\n\n4. **Test Offline Functionality**\n   - Disconnect internet\n   - Process a sale\n   - Reconnect internet\n   - Verify automatic sync\n\n## Offline Functionality Details\n\n### When Offline Mode is Enabled\n\n#### Offline Sales Processing\n- Sales are stored locally in IndexedDB\n- Receipt numbers prefixed with \"RCP-OFF-\"\n- Data queued for sync when online\n\n#### Background Synchronization\n- Automatic sync every 30 seconds when online\n- Manual sync via sync panel\n- Retry mechanism for failed syncs\n\n#### Connection Monitoring\n- Real-time connection status\n- Automatic mode switching\n- Visual indicators and notifications\n\n#### Offline Storage\n- Sales data in IndexedDB\n- Sync queue management\n- Product cache for offline access\n\n### Sync Status Panel\n- Shows pending operations count\n- Displays offline sales summary\n- Manual sync trigger\n- Connection status display\n\n## Development vs Production\n\n### For Development (Current)\n```bash\n# Use this setup for local development\nOFFLINE_MODE_ENABLED=false\n\n# Access via:\nhttp://localhost/eldogaspos/public\n# OR\nhttp://127.0.0.1:8000 (with php artisan serve)\n```\n\n### For Production\n```bash\n# Use this setup for production deployment\nOFFLINE_MODE_ENABLED=true\n\n# Deploy to production server\n# Configure proper domain/subdomain\n```\n\n## Troubleshooting\n\n### \"You're Offline\" Message\n**Solution**: Disable offline mode for development\n```bash\nphp artisan pos:offline-mode disable\nphp artisan config:clear\n```\n\n### No Products Showing\n**Solution**: Run the product fix script\n```bash\nphp quick_product_fix.php\n```\n\n### Offline Features Not Working\n**Solution**: Enable offline mode\n```bash\nphp artisan pos:offline-mode enable\nphp artisan config:clear\n```\n\n### Sync Not Working\n**Check**: \n1. Internet connection\n2. Server accessibility\n3. Browser console for errors\n4. Sync status panel\n\n## File Structure\n\n```\neldogaspos/\n├── config/offline.php              # Offline configuration\n├── public/js/offline-pos.js         # Offline manager script\n├── app/Console/Commands/\n│   └── ToggleOfflineMode.php        # Offline mode command\n├── resources/views/pos/dashboard.blade.php  # Main POS view\n└── .env                             # Environment configuration\n```\n\n## API Changes\n\n### Offline Sync Endpoint\nWhen syncing offline sales, requests include:\n```\nX-Offline-Sync: true\n```\n\n### Sale Data Structure\nOffline sales include additional fields:\n```json\n{\n  \"offline_mode\": true,\n  \"receipt_number\": \"RCP-OFF-20250608-XXXXX\",\n  \"created_at\": \"2025-06-08T10:30:00.000Z\"\n}\n```\n\n## Security Considerations\n\n- Offline data is stored locally in browser\n- Sync uses CSRF tokens\n- Server validates all offline synced data\n- Receipt numbers are unique across online/offline\n\n## Performance Notes\n\n- IndexedDB is async and non-blocking\n- Sync happens in background\n- No impact on online performance\n- Offline storage has browser limits (usually 50MB+)\n\n## Browser Support\n\n- Chrome 58+\n- Firefox 55+\n- Safari 10+\n- Edge 79+\n\n(Requires IndexedDB support)\n\n---\n\n## Quick Reference\n\n### Current Setup (Development)\n```bash\n# Check status\nphp artisan pos:offline-mode status\n\n# Should show: Status: DISABLED\n# Access: http://localhost/eldogaspos/public\n```\n\n### Production Setup\n```bash\n# Enable offline mode\nphp artisan pos:offline-mode enable\nphp artisan config:clear\n\n# Deploy and test offline functionality\n```\n\n### Emergency Reset\n```bash\n# If something goes wrong\nphp artisan pos:offline-mode disable\nphp artisan config:clear\nphp artisan cache:clear\nphp quick_product_fix.php\n```